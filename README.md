# 每日必应故事图片下载脚本

一个功能强大的 Shell 脚本，用于批量下载 [dailybing.com](https://dailybing.com) 上的每日故事配图（UHD 版本）。支持单日期、日期范围下载，具备并发控制、断点续传、HTML 实体解码、旧文件重命名、进度显示等高级功能。

```bash
./fetch_dailybing.sh [-d 输出目录] [-j 并发数] [YYYYMMDD] [YYYYMMDD]
 ``` 
## 1. 单日期下载（默认设置）
```bash
./fetch_dailybing.sh 20260224
```
下载 2026-02-24 的图片

保存到脚本所在目录

文件名格式：20260224@标题.jpg（若标题获取成功）或 20260224.jpg（若标题获取失败）

2. 单日期下载 + 指定输出目录
```bash
./fetch_dailybing.sh -d /path/to/images 20260224
```
图片保存到 /path/to/images

3. 单日期下载 + 指定并发数
```bash
./fetch_dailybing.sh -j 5 20260224
```
并发数设为5（单日期时并发无实际意义，但语法合法）

4. 日期范围下载（默认设置）
```bash
./fetch_dailybing.sh 20260201 20260228
```
下载 2026-02-01 到 2026-02-28 的所有图片（共28天）

保存到脚本所在目录，串行下载

5. 日期范围下载 + 指定输出目录
```bash
./fetch_dailybing.sh -d ./february 20260201 20260228
```
图片保存到当前目录下的 february 文件夹

6. 日期范围下载 + 指定并发数
```bash
./fetch_dailybing.sh -j 5 20260201 20260228
```
并发下载5个任务，提高效率

7. 组合所有选项
```bash
./fetch_dailybing.sh -d /mnt/bing -j 10 20260101 20261231
```
下载全年图片（2026年）

保存到 /mnt/bing

同时并发10个下载任务 
 
## 功能特性

- **日期范围下载**：支持单个日期或起始-结束日期区间（包含首尾）。
- **并发控制**：可设置同时下载的任务数，提高效率。
- **断点续传**：若下载中断，临时文件（`.tmp`）会自动续传。
- **标题智能提取**
- **HTML 实体解码**：自动将 `&ldquo;`、`&rdquo;`、`&nbsp;` 等转换为实际字符。
- **旧文件重命名**：同一日期若存在不同标题的旧文件，自动重命名为新标题，避免重复下载。
- **文件存在跳过**：若目标文件已存在，直接跳过该日期的下载。
- **进度条**：实时显示下载完成百分比。
- **自定义保存路径**：通过 `-d` 选项指定输出目录（默认为脚本所在目录）。
- **日期合法性验证**：
  - 自动检查日期格式（YYYYMMDD）。
  - 限制范围为 `20210315` 至今天，防止无效或未来日期。
- **跨平台兼容**：自动适配 Linux (GNU date) 和 macOS (BSD date)；若 Bash 版本低于 4.3，自动使用轮询方式实现并发。

## 依赖工具

- **必需**：`curl` 或 `wget`（用于下载）
- **推荐**：`pup`（用于更精确的 HTML 解析，非必需，若不存在则使用正则表达式后备）

安装 `pup`（可选）：
```bash
# Debian/Ubuntu
sudo apt install pup

# macOS
brew install pup

